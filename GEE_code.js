/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var Sentinel2 = ee.ImageCollection("COPERNICUS/S2_HARMONIZED"),
    Brazil = /* color: #ffc82d */ee.Geometry.Polygon(
        [[[-57.612626832475094, -30.154734139071458],
          [-56.909501832475094, -30.078708316338076],
          [-53.218095582475094, -32.70421519387236],
          [-53.613603394975094, -33.623870964938725],
          [-52.558915894975094, -33.07323456202442],
          [-52.251298707475094, -32.185015701111055],
          [-50.625322144975094, -30.987133964913145],
          [-49.746415894975094, -29.35355944500935],
          [-48.779619019975094, -28.623212094768462],
          [-48.428056519975094, -27.459649053437705],
          [-48.515947144975094, -25.651541812195177],
          [-46.318681519975094, -23.89599575637596],
          [-43.813798707475094, -23.049521170435334],
          [-42.099931519975094, -22.887676131798365],
          [-40.91456544239993, -22.061349634829153],
          [-40.82667481739993, -20.875382425469983],
          [-39.72804200489993, -19.55579585319562],
          [-39.68409669239993, -18.225325184863557],
          [-39.11280762989993, -17.72372100345383],
          [-38.89308106739993, -15.872731879422203],
          [-38.93702637989993, -13.150248399711156],
          [-38.36573731739993, -12.936190898107585],
          [-36.91554200489993, -10.91545563354559],
          [-34.92963366532168, -8.743885907682047],
          [-34.84174304032168, -6.915470039360436],
          [-35.45697741532168, -5.079950389730561],
          [-37.03900866532168, -4.904836077219925],
          [-39.89674265471182, -2.7948768440427876],
          [-41.65455515471182, -2.838769058594081],
          [-43.71998484221182, -2.3558686556081594],
          [-44.77467234221182, -2.9265484602773775],
          [-44.46705515471182, -2.048479025680374],
          [-44.99439890471182, -1.1699280218942885],
          [-47.98268015471182, -0.5108228736466295],
          [-48.55396921721182, -0.950239201622163],
          [-48.42213327971182, -0.24715699954517034],
          [-50.17994577971182, 0.6317356835520791],
          [-49.87232859221182, 1.6916790307548513],
          [-50.66334421721182, 2.08697104997816],
          [-51.58619577971182, 4.499791989324854],
          [-52.81666452971182, 2.2626256165826457],
          [-56.02467234221182, 2.5260670619114975],
          [-58.88111765471182, 1.340240131199497],
          [-60.02369577971182, 2.83334749898784],
          [-59.62818796721182, 3.973891242116836],
          [-60.19947702971182, 5.244157793718684],
          [-63.18775827971182, 3.842361902179564],
          [-64.98951609221182, 4.280710285405112],
          [-64.06666452971182, 2.5260670619114975],
          [-63.40748484221182, 2.5260670619114975],
          [-63.62721140471182, 2.174800889579672],
          [-65.69264109221182, 0.6372242335443785],
          [-66.52760202971182, 0.8129913380375018],
          [-67.40650827971182, 2.2187139050349405],
          [-68.21481217315048, 1.8249014652066207],
          [-69.97262467315048, 1.7370533058114341],
          [-69.97262467315048, 1.0780761587773322],
          [-69.31344498565048, 1.0341383125476002],
          [-69.26949967315048, 0.6386734265161288],
          [-70.14840592315048, 0.594730660656513],
          [-70.14840592315048, -0.19627390034529588],
          [-69.48922623565048, -1.2069272039096863],
          [-70.10446061065048, -4.410661550308908],
          [-71.55465592315048, -4.279204534984776],
          [-72.96090592315048, -5.155125103049382],
          [-73.35641373565048, -6.5976608542208],
          [-73.92770279815048, -6.90314515364674],
          [-73.88375748565048, -7.8183815609374525],
          [-72.12594498565048, -10.075580354647151],
          [-71.15914811065048, -9.859170378219499],
          [-70.58785904815048, -9.339212175570657],
          [-70.72967234196265, -10.943316214492475],
          [-68.66424265446265, -11.072726401917155],
          [-66.51092234196265, -9.949340203658476],
          [-65.54412546696265, -9.732846929321118],
          [-65.41228952946265, -11.288282678401613],
          [-64.31365671696265, -12.578121750850967],
          [-63.742367654462655, -12.320649876414407],
          [-61.940609841962655, -13.51994148375236],
          [-60.622250466962655, -13.733482884021754],
          [-60.270687966962655, -16.237849547589676],
          [-58.33939194511696, -16.43538266468604],
          [-58.47122788261696, -17.150588580899228],
          [-57.81204819511696, -17.444293114448012],
          [-57.68021225761696, -18.239090331308724],
          [-58.16361069511696, -20.024279756848355],
          [-57.98782944511696, -22.074780605680594],
          [-55.777746867125, -22.40075778771032],
          [-55.426184367125, -23.935942409553892],
          [-54.679114054625, -23.775178591724124],
          [-54.371496867125, -24.136615840301427],
          [-54.679114054625, -25.532417398493216],
          [-53.975989054625, -25.572064523380078],
          [-53.800207804625, -26.283454567460407],
          [-53.800207804625, -27.02966108560897],
          [-55.865637492125, -28.27524987786799]]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
// Filter images by date and region
var startDate = ee.Date('2024-02-01');
var endDate = ee.Date('2024-09-01');
var images = Sentinel2
  .filter(ee.Filter.date(startDate, endDate))
  .filterBounds(Brazil)
  .filter(ee.Filter.lt('CLOUDY_PIXEL_PERCENTAGE', 20));
  
// Difference in days between start and finish
var diff = endDate.difference(startDate, 'week');
// Make a list of all weeks (each advance by 1 week)
var range = ee.List.sequence(0, diff.subtract(1)).map(function(week) {
  return startDate.advance(ee.Number(week), 'week');
});
// Function for iteraton over the range of dates
var week_mosaics = function(date, newlist) {
  // Cast
  date = ee.Date(date);
  newlist = ee.List(newlist);
  // Filter collection between the weeks
  var filtered = images.filterDate(date, date.advance(1,'week'));
  // Make the mosaic
  var image = ee.Image(filtered.mosaic()); 
  // Add the mosaic to a list only if the collection has images
  return ee.List(ee.Algorithms.If(filtered.size(), newlist.add(image), newlist));
};
// Iterate over the range to make a new list, and then cast the list to an imagecollection
var newcol = ee.ImageCollection(ee.List(range.iterate(week_mosaics, ee.List([]))));
print('Weekly images in southern Brazil', newcol);
